# Implementation Plan

- [ ] 1. データベーススキーマの拡張
  - 既存のSQLiteデータベースにIoTセンサー用の新しいテーブルを追加
  - sensor_data, alert_thresholds, device_status, alertsテーブルを作成
  - 既存のplantsテーブルとの外部キー関係を設定
  - _Requirements: 1.1, 2.1, 3.1, 4.1_

- [ ] 2. センサーデータ受信APIの実装
  - POST /api/sensor-dataエンドポイントを作成
  - センサーデータのバリデーション機能を実装
  - デバイス認証機能を追加
  - データベースへの保存処理を実装
  - _Requirements: 1.1, 2.1, 3.1_

- [ ] 3. WebSocketサーバーの実装
  - WebSocketサーバーを既存のExpressサーバーに統合
  - リアルタイムデータ配信機能を実装
  - クライアント接続管理機能を追加
  - _Requirements: 6.1, 6.2_

- [ ] 4. アラートシステムの実装
- [ ] 4.1 閾値管理機能の実装
  - alert_thresholdsテーブルのCRUD操作を実装
  - デフォルト閾値設定機能を追加
  - 植物ごとの閾値カスタマイズ機能を実装
  - _Requirements: 5.1, 5.2_

- [ ] 4.2 アラート判定ロジックの実装
  - センサーデータ受信時の閾値チェック機能を実装
  - アラート生成とデータベース保存機能を追加
  - 重複アラート防止機能を実装
  - _Requirements: 1.2, 2.2, 2.3, 3.2, 5.3_

- [ ] 4.3 通知システムの拡張
  - 既存のSlack通知機能を拡張してIoTアラートに対応
  - ブラウザ通知機能を追加
  - 通知設定のカスタマイズ機能を実装
  - _Requirements: 5.3_

- [ ] 5. デバイス状態監視機能の実装
  - デバイスオンライン/オフライン状態の追跡機能を実装
  - 最終データ受信時刻の記録機能を追加
  - デバイス接続状態のWebSocket配信機能を実装
  - _Requirements: 6.3_

- [ ] 6. センサーデータ履歴API の実装
- [ ] 6.1 データ取得APIの実装
  - GET /api/sensor-data/:plant_id エンドポイントを作成
  - GET /api/sensor-data/:plant_id/history エンドポイントを作成
  - 期間指定でのデータフィルタリング機能を実装
  - _Requirements: 4.1, 4.3_

- [ ] 6.2 データ集約機能の実装
  - 時間単位、日単位でのデータ集約機能を実装
  - 統計情報（平均、最大、最小）の計算機能を追加
  - パフォーマンス最適化のためのインデックス作成
  - _Requirements: 4.2_

- [ ] 7. フロントエンド - リアルタイムダッシュボードの実装
- [ ] 7.1 WebSocketクライアントの実装
  - WebSocket接続とリアルタイムデータ受信機能を実装
  - 接続エラー時の自動再接続機能を追加
  - データ受信時のUI更新機能を実装
  - _Requirements: 6.1, 6.2_

- [ ] 7.2 センサーデータ表示UIの実装
  - 現在のセンサー値表示コンポーネントを作成
  - 土壌湿度、温度、湿度、光量の表示機能を実装
  - デバイス接続状態インジケーターを追加
  - _Requirements: 1.3, 2.1, 3.3, 6.3_

- [ ] 8. フロントエンド - データ可視化機能の実装
- [ ] 8.1 Chart.jsライブラリの統合
  - Chart.jsライブラリを既存プロジェクトに追加
  - 時系列グラフ表示機能の基盤を実装
  - レスポンシブデザイン対応を追加
  - _Requirements: 4.2_

- [ ] 8.2 履歴データグラフの実装
  - 過去24時間のデータグラフ表示機能を実装
  - 期間選択機能（1日、1週間、1ヶ月）を追加
  - 複数センサーデータの同時表示機能を実装
  - _Requirements: 4.2, 4.3_

- [ ] 9. フロントエンド - アラート設定UIの実装
- [ ] 9.1 閾値設定フォームの実装
  - 各センサーの閾値設定フォームを作成
  - 植物ごとの個別設定機能を実装
  - 設定値のバリデーション機能を追加
  - _Requirements: 5.1, 5.2_

- [ ] 9.2 アラート表示機能の実装
  - リアルタイムアラート通知の表示機能を実装
  - アラート履歴表示機能を追加
  - アラート解決機能を実装
  - _Requirements: 5.3_

- [ ] 10. 既存植物管理機能との統合
- [ ] 10.1 植物カードの拡張
  - 既存の植物カードにセンサーデータ表示を追加
  - アラート状態の視覚的表示機能を実装
  - センサーデータ詳細表示モーダルを追加
  - _Requirements: 1.3, 2.1, 3.3_

- [ ] 10.2 植物登録フォームの拡張
  - 植物登録時のデバイスID設定機能を追加
  - デフォルト閾値設定機能を実装
  - センサー監視の有効/無効設定を追加
  - _Requirements: 5.1_

- [ ] 11. エラーハンドリングとログ機能の実装
- [ ] 11.1 サーバーサイドエラーハンドリング
  - センサーデータ受信エラーの処理機能を実装
  - WebSocket接続エラーの処理機能を追加
  - データベースエラーの処理とログ記録機能を実装
  - _Requirements: 全般_

- [ ] 11.2 クライアントサイドエラーハンドリング
  - WebSocket接続失敗時の処理機能を実装
  - データ取得エラー時のフォールバック機能を追加
  - ユーザーフレンドリーなエラーメッセージ表示を実装
  - _Requirements: 6.2, 6.3_

- [ ] 12. テスト機能の実装
- [ ] 12.1 センサーデータシミュレーター
  - 開発・テスト用のセンサーデータ生成機能を実装
  - ランダムデータ生成とアラート条件テスト機能を追加
  - 複数デバイスシミュレーション機能を実装
  - _Requirements: 全般_

- [ ] 12.2 単体テストの作成
  - センサーデータAPI のテストケースを作成
  - アラート判定ロジックのテストケースを追加
  - WebSocket通信のテストケースを実装
  - _Requirements: 全般_

- [ ] 13. パフォーマンス最適化
- [ ] 13.1 データベース最適化
  - センサーデータテーブルのインデックス作成
  - 古いデータの自動削除機能を実装
  - クエリパフォーマンスの最適化
  - _Requirements: 4.1, 4.2_

- [ ] 13.2 フロントエンド最適化
  - グラフデータのキャッシュ機能を実装
  - リアルタイム更新の最適化
  - メモリ使用量の最適化
  - _Requirements: 6.1, 6.2_

- [ ] 14. ドキュメントとセットアップガイドの作成
- [ ] 14.1 IoTデバイス設定ガイド
  - Arduino/ESP32のセットアップ手順書を作成
  - センサー接続図とコード例を追加
  - WiFi設定とAPI接続手順を記載
  - _Requirements: 全般_

- [ ] 14.2 システム運用ガイド
  - サーバー設定とデプロイ手順を作成
  - 監視とメンテナンス手順を追加
  - トラブルシューティングガイドを作成
  - _Requirements: 全般_